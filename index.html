<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Live counter</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>

  <script>
    $(document).ready(function() {
      var count = 0;
      var interval = setInterval(function() {
        count++;
        $('#counter').text(count);
      }, 1000);

      let totalSeconds = 0;
      let session = readLocalStorage();
      
      if (session.updated - session.created < 2000) {
        totalSeconds = session.count;
      } else {
        fillPreviousCount(session);      
    }
      
      console.log(session.updated - session.created);


      function readLocalStorage() {
        return {
          count: parseInt(localStorage.getItem('count')),
          created: new Date(localStorage.getItem('created')),
          updated: new Date(localStorage.getItem('updated')),
        }
      }

      function writeLocalStorage(count) {
        localStorage.setItem('count', count);

        if (count == 1) {
          localStorage.setItem('created', new Date());
        }

        localStorage.setItem('updated', new Date());
      }
      //------------


      let dayslabel = document.getElementById("days");
      let hourslabel = document.getElementById("hours");
      let minutesLabel = document.getElementById("minutes");
      let secondsLabel = document.getElementById("seconds");
      
      setInterval(setTime, 1000);

      function setTime() {
        ++totalSeconds;
        secondsLabel.innerHTML = pad(totalSeconds % 60);
        minutesLabel.innerHTML = pad(parseInt(totalSeconds / 60));
        hourslabel.innerHTML = pad(parseInt(totalSeconds / 3600));
        dayslabel.innerHTML = pad(parseInt(totalSeconds / 86400));

        currentTime = convertSecondsToTime(totalSeconds);
        console.log(currentTime);

        writeLocalStorage(totalSeconds);
      }

      function pad(val) {
        var valString = val + "";
        if (valString.length < 2) {
          return "0" + valString;
        } else {
          return valString;
        }
      }

    });
    function convertSecondsToTime(seconds) {
        console.log('convertSecondsToTime: ',seconds);
        let hours = parseInt(seconds / 3600);
        let minutes = parseInt((seconds - (hours * 3600)) / 60);
            seconds = seconds - (hours * 3600) - (minutes * 60);
        let days = parseInt(hours / 24);  

        if (hours < 10) {
          hours = "0" + hours;
        }
        if (minutes < 10) {
          minutes = "0" + minutes;
        }
        if (seconds < 10) {
          seconds = "0" + seconds;
        }
        
        if (days > 0 ) {
          return days + "d " + hours + ":" + minutes + ":" + seconds;
        } else {
          return hours + ":" + minutes + ":" + seconds;
        }
  
      }

    

    function fillPreviousCount(session) {
      console.log(session);
      document.getElementById("prev-counter-created").innerHTML = session.created;
      document.getElementById("prev-counter-updated").innerHTML = session.updated;
      document.getElementById("prev-counter-time").innerHTML = convertSecondsToTime(session.count);
    }

    
  

    </script>
</head>

<body>
<div id="counter">0</div>
<div class="">
<label id="days">0</label> day(s) <label id="hours">00</label>:<label id="minutes">00</label>:<label id="seconds">00</label>
</div>

<div id="prev-counter">
  <h2>Previous values:</h2>
  <div id="prev-counter-created"></div>
  <div id="prev-counter-updated"></div>
  <div id="prev-counter-time"></div>
</div>

</body>
</html>