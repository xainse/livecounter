<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Live counter</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
   
   
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html, body, main {
        height: 100%;
      }
      body {
        font-family: 'Share Tech Mono', monospace;
        background-color: #269;
        background-image:
          linear-gradient(rgba(255,255,255,.5) 2px, transparent 2px),
          linear-gradient(90deg, rgba(255,255,255,.5) 2px, transparent 2px),
          linear-gradient(rgba(255,255,255,.28) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255,255,255,.28) 1px, transparent 1px);
        background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;
        background-position: -2px -2px, -2px -2px, -1px -1px, -1px -1px;
      }
    
      .current-time{
        width: 100%;
        height: 80%;
        margin-top: 10%;
        font-size: 180px;
        color: #fff;
        text-align: center;
        vertical-align: middle;
      }
      .prev-counter {
        position: absolute;
        bottom: 0;
        right: 0;
        background: #FFF;
        padding: 20px;
        color: #000;
      }

  
  </style>

  <script>
    $(document).ready(function() {
      var count = 0;
      var interval = setInterval(function() {
        count++;
        $('#counter').text(count);
      }, 1000);

      let totalSeconds = 0;
      let session = readLocalStorage();
      
      if (session.updated - session.created < 2000) {
        totalSeconds = session.count;
      } else {
        fillPreviousCount(session);      
    }
      
      console.log(session.updated - session.created);


      function readLocalStorage() {
        return {
          count: parseInt(localStorage.getItem('count')),
          created: new Date(localStorage.getItem('created')),
          updated: new Date(localStorage.getItem('updated')),
        }
      }

      function writeLocalStorage(count) {
        localStorage.setItem('count', count);

        if (count == 1) {
          localStorage.setItem('created', new Date());
        }

        localStorage.setItem('updated', new Date());
      }
      //----------------------------------------------------------------------------------
      
      setInterval(setTime, 1000);

      function setTime() {
        ++totalSeconds;
      
        currentTime = convertSecondsToTime(totalSeconds);
        document.getElementById("current-time").innerHTML = currentTime;
        console.log(currentTime);

        writeLocalStorage(totalSeconds);
      }

    });
    function convertSecondsToTime(seconds) {
        console.log('convertSecondsToTime: ',seconds);
        let hours = parseInt(seconds / 3600);
        let minutes = parseInt((seconds - (hours * 3600)) / 60);
            seconds = seconds - (hours * 3600) - (minutes * 60);
        let days = parseInt(hours / 24);  

        if (hours < 10) {
          hours = "0" + hours;
        }
        if (minutes < 10) {
          minutes = "0" + minutes;
        }
        if (seconds < 10) {
          seconds = "0" + seconds;
        }
        
        if (days > 0 ) {
          return days + "d " + hours + ":" + minutes + ":" + seconds;
        } else {
          return hours + ":" + minutes + ":" + seconds;
        }
  
      }

    

    function fillPreviousCount(session) {
      console.log(session);
      document.getElementById("prev-counter-created").innerHTML = session.created;
      document.getElementById("prev-counter-updated").innerHTML = session.updated;
      document.getElementById("prev-counter-time").innerHTML = convertSecondsToTime(session.count);
    }

    
  

    </script>
</head>

<body>
    <div id="counter">0</div>
    <div class="current-time" id="current-time">00:00:00</div>

    <div id="prev-counter" class="prev-counter">
      <h2>Previous values:</h2>
      <div id="prev-counter-created"></div>
      <div id="prev-counter-updated"></div>
      <div id="prev-counter-time"></div>
    </div>
</body>
</html>